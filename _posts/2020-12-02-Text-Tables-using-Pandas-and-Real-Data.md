---
keywords: fastai
description: Sample Covid-19 API Data pulled, flattened, imported into pandas dataframe, and printed to plain text table.
title: Plain Text Tables using Pandas and Real Data
toc: true
badges: true
comments: true
categories: [general, pandas, covid19, tables, data]
nb_path: _notebooks/2020-12-3-Text Tables using Pandas and Real Data.ipynb
layout: notebook
---

<!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2020-12-3-Text Tables using Pandas and Real Data.ipynb
-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Pull-Data-into-Pandas-and-Print-with-Tabulate">Pull Data into Pandas and Print with Tabulate<a class="anchor-link" href="#Pull-Data-into-Pandas-and-Print-with-Tabulate"> </a></h2><h3 id="Step-1:-Pull-Parse-Data-at-a-High-Level">Step 1: Pull Parse Data at a High Level<a class="anchor-link" href="#Step-1:-Pull-Parse-Data-at-a-High-Level"> </a></h3><ul>
<li><code>requests</code> is used to query region 8 data from an IL IDPH endpoint</li>
<li><code>json</code> parses the chunk of data needed</li>
<li>In the output below it shows that the json structure currently is broken into an object that lists the date, then has additional nested objects for all of the individual country data for that date.</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>

<span class="n">query_url</span> <span class="o">=</span> <span class="s1">&#39;https://idph.illinois.gov/DPHPublicInformation/api/COVID/GetResurgenceData?regionID=8&amp;daysIncluded=5&#39;</span> <span class="c1"># max is 170 days #+ selectedRegion + &#39;&amp;daysIncluded=&#39; + chartRange</span>
<span class="n">page</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">query_url</span><span class="p">)</span>

<span class="c1"># Use just the county level positivity reports</span>
<span class="n">positivity_rates</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;CountyTestPositivityReports&#39;</span><span class="p">]</span>

<span class="n">print_title</span><span class="p">(</span><span class="s1">&#39;2 DAYS OF DATA IN RAW FORM&#39;</span><span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">positivity_rates</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>--------------------------
2 DAYS OF DATA IN RAW FORM
--------------------------
[{&#39;countyTestPositivities&#39;: [{&#39;CountyName&#39;: &#39;DuPage&#39;,
                              &#39;dailyPositivity&#39;: 0.0,
                              &#39;positive_test&#39;: 777,
                              &#39;positivityRollingAvg&#39;: 12.3,
                              &#39;regionID&#39;: 8,
                              &#39;totalTest&#39;: 6411},
                             {&#39;CountyName&#39;: &#39;Kane&#39;,
                              &#39;dailyPositivity&#39;: 0.0,
                              &#39;positive_test&#39;: 517,
                              &#39;positivityRollingAvg&#39;: 16.3,
                              &#39;regionID&#39;: 8,
                              &#39;totalTest&#39;: 3790}],
  &#39;reportDate&#39;: &#39;2020-11-24T00:00:00&#39;},
 {&#39;countyTestPositivities&#39;: [{&#39;CountyName&#39;: &#39;DuPage&#39;,
                              &#39;dailyPositivity&#39;: 0.0,
                              &#39;positive_test&#39;: 731,
                              &#39;positivityRollingAvg&#39;: 12.0,
                              &#39;regionID&#39;: 8,
                              &#39;totalTest&#39;: 6365},
                             {&#39;CountyName&#39;: &#39;Kane&#39;,
                              &#39;dailyPositivity&#39;: 0.0,
                              &#39;positive_test&#39;: 409,
                              &#39;positivityRollingAvg&#39;: 15.5,
                              &#39;regionID&#39;: 8,
                              &#39;totalTest&#39;: 2847}],
  &#39;reportDate&#39;: &#39;2020-11-25T00:00:00&#39;}]
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Step-2:-Flatten-Nested-Data-into-Single-Level-JSON-Objects">Step 2: Flatten Nested Data into Single Level JSON Objects<a class="anchor-link" href="#Step-2:-Flatten-Nested-Data-into-Single-Level-JSON-Objects"> </a></h3><ul>
<li>It's much easier to import into Pandas when a json object (or any object for that matter, such as a list or tuple) is only one level deep. If data is nested, Pandas' default behavior is to import an entire nested object into a single cell.</li>
<li>The code below takes the existing list of json objects, and pulls each nested piece of county information out to insert into a new list at the top level.<ul>
<li>While the code creates the new list, line by line, it also inserts the date (converted to a datetime object) into each section as it's processed.</li>
</ul>
</li>
<li>In the output below shows a bit of the new json structure. It's a list of non-nested json objects, and each one is associated with date.</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Flatten needed json data into a list so it can be imported to a pandas dataframe</span>
<span class="n">flattened_positivity_rates</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">dates</span> <span class="ow">in</span> <span class="n">positivity_rates</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">county</span> <span class="ow">in</span> <span class="n">dates</span><span class="p">[</span><span class="s1">&#39;countyTestPositivities&#39;</span><span class="p">]:</span>
        <span class="n">county</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">dates</span><span class="p">[</span><span class="s1">&#39;reportDate&#39;</span><span class="p">],</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%S&quot;</span><span class="p">)</span>
        <span class="n">flattened_positivity_rates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">county</span><span class="p">)</span>

<span class="n">print_title</span><span class="p">(</span><span class="s1">&#39;SAME 2 DAYS OF DATA, BUT FLATTENED&#39;</span><span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">flattened_positivity_rates</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>----------------------------------
SAME 2 DAYS OF DATA, BUT FLATTENED
----------------------------------
[{&#39;CountyName&#39;: &#39;DuPage&#39;,
  &#39;dailyPositivity&#39;: 0.0,
  &#39;date&#39;: datetime.datetime(2020, 11, 24, 0, 0),
  &#39;positive_test&#39;: 777,
  &#39;positivityRollingAvg&#39;: 12.3,
  &#39;regionID&#39;: 8,
  &#39;totalTest&#39;: 6411},
 {&#39;CountyName&#39;: &#39;Kane&#39;,
  &#39;dailyPositivity&#39;: 0.0,
  &#39;date&#39;: datetime.datetime(2020, 11, 24, 0, 0),
  &#39;positive_test&#39;: 517,
  &#39;positivityRollingAvg&#39;: 16.3,
  &#39;regionID&#39;: 8,
  &#39;totalTest&#39;: 3790}]
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Step-3:-Import-Data-into-Pandas,-a-Little-Cleanup,-and-Reorder-Columns">Step 3: Import Data into Pandas, a Little Cleanup, and Reorder Columns<a class="anchor-link" href="#Step-3:-Import-Data-into-Pandas,-a-Little-Cleanup,-and-Reorder-Columns"> </a></h3><ul>
<li>Once each json object in the list is only single level, creating a pandas dataframe out it is a simple one line statement.</li>
<li>One thing that doesn't come with this dataset is the daily average, but it includes the data needs to calculate it. Again, calculating the data and inserting it as a new column is a single line statement.</li>
<li>Finally, it's easy to reorder the columns, and leave out unneeded columns in a single statement as well. The output above shows 'dailyPositivity' with a value of 0 - which is the same for every json object in the entire dataset. In the reorder columns statement below removing it is a simple as leaving it out.</li>
<li>The results can be seen in the output below. This has the data that's needed, but it's still pretty messy.</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">tabulate</span> <span class="kn">import</span> <span class="n">tabulate</span>

<span class="c1"># Create pandas dataframe</span>
<span class="n">region_rates_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">flattened_positivity_rates</span><span class="p">)</span>

<span class="c1"># Calulate daily average based on using total tests and the daily positive tests</span>
<span class="n">region_rates_df</span><span class="p">[</span><span class="s1">&#39;daily_avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">region_rates_df</span><span class="p">[</span><span class="s1">&#39;positive_test&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">region_rates_df</span><span class="p">[</span><span class="s1">&#39;totalTest&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span>

<span class="c1"># Reorder Columns</span>
<span class="n">region_rates_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">region_rates_df</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;regionID&#39;</span><span class="p">,</span> <span class="s1">&#39;CountyName&#39;</span><span class="p">,</span> <span class="s1">&#39;totalTest&#39;</span><span class="p">,</span> <span class="s1">&#39;positive_test&#39;</span><span class="p">,</span> <span class="s1">&#39;daily_avg&#39;</span><span class="p">,</span> <span class="s1">&#39;positivityRollingAvg&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Step-4:-Data-Cleanup-in-Pandas">Step 4: Data Cleanup in Pandas<a class="anchor-link" href="#Step-4:-Data-Cleanup-in-Pandas"> </a></h3><ul>
<li>Renaming columns is a single step, and the order here doesn't matter (does not change the order in the dataframe)</li>
<li>Cleaning up the date format is simple, especially because when the json was flattened the date was inserted as a datetime formatted object (which was converted to a pandas "timestamp" by the dataframe import process)<ul>
<li>Above the date may look fine, but that's because the Jupyter Lab pandas printout removes the hours, minutes, seconds, and microseconds if they are zeros. In reality the actual values looked something like the following: '2020-11-17T00:00:00:00'.</li>
</ul>
</li>
<li>The original Daily Avg calculation didn't specify decimal place at all. <code>.round(2)</code> easy changes that.</li>
<li>Finally, it makes sense to make certain that the rows are sorted by date.</li>
<li>In the out put below, everything looks much better, but the back and forth of DuPage and Kane makes it a little difficult to read.</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Rename Columns</span>
<span class="n">region_rates_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;date&#39;</span><span class="p">:</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="s1">&#39;regionID&#39;</span><span class="p">:</span><span class="s1">&#39;Region&#39;</span><span class="p">,</span> <span class="s1">&#39;CountyName&#39;</span><span class="p">:</span><span class="s1">&#39;County&#39;</span><span class="p">,</span> <span class="s1">&#39;totalTest&#39;</span><span class="p">:</span><span class="s1">&#39;Total Tests&#39;</span><span class="p">,</span>
             <span class="s1">&#39;daily_avg&#39;</span><span class="p">:</span><span class="s1">&#39;Daily Avg&#39;</span><span class="p">,</span> <span class="s1">&#39;positivityRollingAvg&#39;</span><span class="p">:</span><span class="s1">&#39;Rolling Avg&#39;</span><span class="p">,</span> <span class="s1">&#39;positive_test&#39;</span><span class="p">:</span><span class="s1">&#39;Positive&#39;</span><span class="p">},</span> 
    <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="c1"># Shorten &#39;Date&#39;</span>
<span class="n">region_rates_df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">region_rates_df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">/%Y&#39;</span><span class="p">)</span>

<span class="c1"># Round Daily Avg to 2 Decimal Places</span>
<span class="n">region_rates_df</span><span class="p">[</span><span class="s1">&#39;Daily Avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">region_rates_df</span><span class="p">[</span><span class="s1">&#39;Daily Avg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Sort dataframe by &#39;Date&#39;</span>
<span class="n">region_rates_df</span> <span class="o">=</span> <span class="n">region_rates_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s1">&#39;Date&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Step 5: Print Individual County Date into Plain Text Tables</p>
<ul>
<li>The Jupyter Lab printouts of dataframes looks pretty nice, but when printing to a console it looks much more rudementary.</li>
<li>Below, <code>.unique()</code> (actually a 'numpy' library feature) pulls out the county names represented in the dataframe into a 'numpy' array.<ul>
<li>Similar to objects like lists, the numpy array can be iterated.</li>
</ul>
</li>
<li>The print statement does several things:<ul>
<li>Takes the entire dataframe on each pass (may not be a good idea if the dataframe were very large) and filters it to only include rows with the County name represented by the 'name' variable.</li>
<li>Sets headers as 'keys', which just specifies that the headers show up. This parameter works differently depending on the kind of input (i.e., if printing a list of lists where index 0 was a list of headers, <code>headers=list[0]</code> would be used instead)</li>
<li>Sets the table format. Tabulate has a long list of formats available for use.</li>
<li>Removes the index (in this case the index that Pandas uses by default)</li>
</ul>
</li>
<li>The output below shows the results of the work above. Each country is printed in it's own table, with data that is fairly clean and easy to read.</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Create array of unique county names</span>
<span class="n">counties</span> <span class="o">=</span> <span class="n">region_rates_df</span><span class="p">[</span><span class="s1">&#39;County&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>

<span class="c1"># Print a table for each county</span>
<span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">counties</span><span class="p">:</span>
    <span class="c1"># Prints individual country by filtering with a query (i.e., &#39;County&#39; = name)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">tabulate</span><span class="p">(</span><span class="n">region_rates_df</span><span class="p">[(</span><span class="n">region_rates_df</span><span class="p">[</span><span class="s1">&#39;County&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">name</span><span class="p">)],</span> <span class="n">headers</span> <span class="o">=</span> <span class="s1">&#39;keys&#39;</span><span class="p">,</span> <span class="n">tablefmt</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;psql&#39;</span><span class="p">),</span> <span class="n">showindex</span><span class="o">=</span><span class="s2">&quot;never&quot;</span><span class="p">),</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>+------------+----------+----------+---------------+------------+-------------+---------------+
| Date       |   Region | County   |   Total Tests |   Positive |   Daily Avg |   Rolling Avg |
|------------+----------+----------+---------------+------------+-------------+---------------|
| 11/24/2020 |        8 | DuPage   |          6411 |        777 |       12.12 |          12.3 |
| 11/25/2020 |        8 | DuPage   |          6365 |        731 |       11.48 |          12   |
| 11/26/2020 |        8 | DuPage   |          5301 |        660 |       12.45 |          11.8 |
| 11/27/2020 |        8 | DuPage   |          5055 |        712 |       14.09 |          11.9 |
| 11/28/2020 |        8 | DuPage   |          4505 |        474 |       10.52 |          11.7 |
| 11/29/2020 |        8 | DuPage   |          4188 |        431 |       10.29 |          11.4 |
+------------+----------+----------+---------------+------------+-------------+---------------+ 

+------------+----------+----------+---------------+------------+-------------+---------------+
| Date       |   Region | County   |   Total Tests |   Positive |   Daily Avg |   Rolling Avg |
|------------+----------+----------+---------------+------------+-------------+---------------|
| 11/24/2020 |        8 | Kane     |          3790 |        517 |       13.64 |          16.3 |
| 11/25/2020 |        8 | Kane     |          2847 |        409 |       14.37 |          15.5 |
| 11/26/2020 |        8 | Kane     |          2467 |        433 |       17.55 |          15.9 |
| 11/27/2020 |        8 | Kane     |          2399 |        413 |       17.22 |          15.4 |
| 11/28/2020 |        8 | Kane     |          1568 |        282 |       17.98 |          15   |
| 11/29/2020 |        8 | Kane     |          1750 |        265 |       15.14 |          15   |
+------------+----------+----------+---------------+------------+-------------+---------------+ 

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Extra:-The-Code-Works-for-Any-Region-or-Number-of-Days">Extra: The Code Works for Any Region or Number of Days<a class="anchor-link" href="#Extra:-The-Code-Works-for-Any-Region-or-Number-of-Days"> </a></h2><ul>
<li>The only hardcoded elements in the previous section were the region number and days in the initial endpoint url.</li>
<li>This means that any region or number of days can be used and the process will work the same.</li>
<li>The output below was produced with the same code by requesting 20 days of data from region 7. Region 7 was used because it also only has 2 counties (easier to use in a blog post), but regions with 10 or more counties work fine as well.</li>
<li>(all of the code above pulled together in one cell can also be viewed by clicking "Expand")</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p><div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#collapse</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">tabulate</span> <span class="kn">import</span> <span class="n">tabulate</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">datetime</span><span class="o">,</span> <span class="nn">json</span><span class="o">,</span> <span class="nn">sys</span>

<span class="n">region</span> <span class="o">=</span> <span class="mi">7</span>
<span class="n">days</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">query_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;https://idph.illinois.gov/DPHPublicInformation/api/COVID/GetResurgenceData?regionID=</span><span class="si">{</span><span class="n">region</span><span class="si">}</span><span class="s1">&amp;daysIncluded=</span><span class="si">{</span><span class="n">days</span><span class="si">}</span><span class="s1">&#39;</span> <span class="c1"># max is 170 days #+ selectedRegion + &#39;&amp;daysIncluded=&#39; + chartRange</span>
<span class="n">page</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">query_url</span><span class="p">)</span>

<span class="c1"># Use just the county level positivity reports</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">positivity_rates</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;CountyTestPositivityReports&#39;</span><span class="p">]</span>
<span class="k">except</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Selected json object not available. It</span><span class="se">\&#39;</span><span class="s1">s possible an invalid region was queried&#39;</span><span class="p">)</span>
    <span class="k">raise</span>

<span class="c1"># Flatten needed json data into a list so it can be imported to a pandas dataframe</span>
<span class="n">flattened_positivity_rates</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">dates</span> <span class="ow">in</span> <span class="n">positivity_rates</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">county</span> <span class="ow">in</span> <span class="n">dates</span><span class="p">[</span><span class="s1">&#39;countyTestPositivities&#39;</span><span class="p">]:</span>
        <span class="n">county</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">dates</span><span class="p">[</span><span class="s1">&#39;reportDate&#39;</span><span class="p">],</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%S&quot;</span><span class="p">)</span>
        <span class="n">flattened_positivity_rates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">county</span><span class="p">)</span>

<span class="c1"># Create pandas dataframe</span>
<span class="n">region_rates_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">flattened_positivity_rates</span><span class="p">)</span>

<span class="c1"># Calulate daily average based on using total tests and the daily positive tests</span>
<span class="n">region_rates_df</span><span class="p">[</span><span class="s1">&#39;daily_avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">region_rates_df</span><span class="p">[</span><span class="s1">&#39;positive_test&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">region_rates_df</span><span class="p">[</span><span class="s1">&#39;totalTest&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span>

<span class="c1"># Reorder Columns</span>
<span class="n">region_rates_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">region_rates_df</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;regionID&#39;</span><span class="p">,</span> <span class="s1">&#39;CountyName&#39;</span><span class="p">,</span> <span class="s1">&#39;totalTest&#39;</span><span class="p">,</span> <span class="s1">&#39;positive_test&#39;</span><span class="p">,</span> <span class="s1">&#39;daily_avg&#39;</span><span class="p">,</span> <span class="s1">&#39;positivityRollingAvg&#39;</span><span class="p">])</span>

<span class="c1"># Rename Columns</span>
<span class="n">region_rates_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;date&#39;</span><span class="p">:</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="s1">&#39;regionID&#39;</span><span class="p">:</span><span class="s1">&#39;Region&#39;</span><span class="p">,</span> <span class="s1">&#39;CountyName&#39;</span><span class="p">:</span><span class="s1">&#39;County&#39;</span><span class="p">,</span> <span class="s1">&#39;totalTest&#39;</span><span class="p">:</span><span class="s1">&#39;Total Tests&#39;</span><span class="p">,</span>
             <span class="s1">&#39;daily_avg&#39;</span><span class="p">:</span><span class="s1">&#39;Daily Avg&#39;</span><span class="p">,</span> <span class="s1">&#39;positivityRollingAvg&#39;</span><span class="p">:</span><span class="s1">&#39;Rolling Avg&#39;</span><span class="p">,</span> <span class="s1">&#39;positive_test&#39;</span><span class="p">:</span><span class="s1">&#39;Positive&#39;</span><span class="p">},</span> 
    <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="c1"># Shorten &#39;Date&#39;</span>
<span class="n">region_rates_df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">region_rates_df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">/%Y&#39;</span><span class="p">)</span>

<span class="c1"># Round Daily Avg to 2 Decimal Places</span>
<span class="n">region_rates_df</span><span class="p">[</span><span class="s1">&#39;Daily Avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">region_rates_df</span><span class="p">[</span><span class="s1">&#39;Daily Avg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Sort dataframe by &#39;Date&#39;</span>
<span class="n">region_rates_df</span> <span class="o">=</span> <span class="n">region_rates_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s1">&#39;Date&#39;</span><span class="p">])</span>

<span class="c1"># Create array of unique county names</span>
<span class="n">counties</span> <span class="o">=</span> <span class="n">region_rates_df</span><span class="p">[</span><span class="s1">&#39;County&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>

<span class="c1"># Print a table for each county</span>
<span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">counties</span><span class="p">:</span>
    <span class="c1"># Prints individual country by filtering with a query (i.e., &#39;County&#39; = name)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">tabulate</span><span class="p">(</span><span class="n">region_rates_df</span><span class="p">[(</span><span class="n">region_rates_df</span><span class="p">[</span><span class="s1">&#39;County&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">name</span><span class="p">)],</span> <span class="n">headers</span> <span class="o">=</span> <span class="s1">&#39;keys&#39;</span><span class="p">,</span> <span class="n">tablefmt</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;psql&#39;</span><span class="p">)),</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>
</p>
    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>+----+------------+----------+----------+---------------+------------+-------------+---------------+
|    | Date       |   Region | County   |   Total Tests |   Positive |   Daily Avg |   Rolling Avg |
|----+------------+----------+----------+---------------+------------+-------------+---------------|
|  0 | 11/09/2020 |        7 | Kankakee |           761 |        203 |       26.68 |          19.2 |
|  2 | 11/10/2020 |        7 | Kankakee |          1383 |        220 |       15.91 |          18.8 |
|  4 | 11/11/2020 |        7 | Kankakee |          1450 |        242 |       16.69 |          19.1 |
|  6 | 11/12/2020 |        7 | Kankakee |          1009 |        257 |       25.47 |          20.1 |
|  8 | 11/13/2020 |        7 | Kankakee |          1640 |        353 |       21.52 |          20.3 |
| 10 | 11/14/2020 |        7 | Kankakee |          1143 |        343 |       30.01 |          21.9 |
| 12 | 11/15/2020 |        7 | Kankakee |          1187 |        326 |       27.46 |          22.7 |
| 14 | 11/16/2020 |        7 | Kankakee |           642 |        159 |       24.77 |          22.5 |
| 16 | 11/17/2020 |        7 | Kankakee |          1268 |        189 |       14.91 |          22.4 |
| 18 | 11/18/2020 |        7 | Kankakee |          1570 |        222 |       14.14 |          21.9 |
| 20 | 11/19/2020 |        7 | Kankakee |          1217 |        185 |       15.2  |          20.5 |
| 22 | 11/20/2020 |        7 | Kankakee |          2067 |        265 |       12.82 |          18.6 |
| 24 | 11/21/2020 |        7 | Kankakee |           948 |        251 |       26.48 |          17.9 |
| 26 | 11/22/2020 |        7 | Kankakee |          1072 |        239 |       22.29 |          17.2 |
| 28 | 11/23/2020 |        7 | Kankakee |          1024 |        150 |       14.65 |          16.4 |
| 30 | 11/24/2020 |        7 | Kankakee |          1753 |        225 |       12.84 |          15.9 |
| 32 | 11/25/2020 |        7 | Kankakee |          1931 |        231 |       11.96 |          15.4 |
| 34 | 11/26/2020 |        7 | Kankakee |           877 |        188 |       21.44 |          16   |
| 36 | 11/27/2020 |        7 | Kankakee |           601 |        109 |       18.14 |          17   |
| 38 | 11/28/2020 |        7 | Kankakee |          1027 |        169 |       16.46 |          15.8 |
| 40 | 11/29/2020 |        7 | Kankakee |           756 |         91 |       12.04 |          14.6 |
+----+------------+----------+----------+---------------+------------+-------------+---------------+ 

+----+------------+----------+----------+---------------+------------+-------------+---------------+
|    | Date       |   Region | County   |   Total Tests |   Positive |   Daily Avg |   Rolling Avg |
|----+------------+----------+----------+---------------+------------+-------------+---------------|
|  1 | 11/09/2020 |        7 | Will     |          4663 |        863 |       18.51 |          18.3 |
|  3 | 11/10/2020 |        7 | Will     |          4160 |        808 |       19.42 |          18.5 |
|  5 | 11/11/2020 |        7 | Will     |          4237 |        902 |       21.29 |          19.2 |
|  7 | 11/12/2020 |        7 | Will     |          4149 |        831 |       20.03 |          19.7 |
|  9 | 11/13/2020 |        7 | Will     |          4210 |        817 |       19.41 |          19.6 |
| 11 | 11/14/2020 |        7 | Will     |          3461 |        821 |       23.72 |          19.9 |
| 13 | 11/15/2020 |        7 | Will     |          4014 |        761 |       18.96 |          20.1 |
| 15 | 11/16/2020 |        7 | Will     |          4316 |        821 |       19.02 |          20.2 |
| 17 | 11/17/2020 |        7 | Will     |          3466 |        643 |       18.55 |          20.1 |
| 19 | 11/18/2020 |        7 | Will     |          4186 |        752 |       17.96 |          19.6 |
| 21 | 11/19/2020 |        7 | Will     |          4093 |        826 |       20.18 |          19.6 |
| 23 | 11/20/2020 |        7 | Will     |          4600 |        821 |       17.85 |          19.4 |
| 25 | 11/21/2020 |        7 | Will     |          3408 |        638 |       18.72 |          18.7 |
| 27 | 11/22/2020 |        7 | Will     |          4131 |        682 |       16.51 |          18.4 |
| 29 | 11/23/2020 |        7 | Will     |          3870 |        624 |       16.12 |          18   |
| 31 | 11/24/2020 |        7 | Will     |          4729 |        768 |       16.24 |          17.6 |
| 33 | 11/25/2020 |        7 | Will     |          4262 |        731 |       17.15 |          17.5 |
| 35 | 11/26/2020 |        7 | Will     |          3065 |        625 |       20.39 |          17.4 |
| 37 | 11/27/2020 |        7 | Will     |          3568 |        658 |       18.44 |          17.5 |
| 39 | 11/28/2020 |        7 | Will     |          2673 |        490 |       18.33 |          17.4 |
| 41 | 11/29/2020 |        7 | Will     |          2631 |        381 |       14.48 |          17.2 |
+----+------------+----------+----------+---------------+------------+-------------+---------------+ 

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

