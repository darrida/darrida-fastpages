---
keywords: fastai
description: Taking the simple tables concept from a previous post and using real data.
title: Advanced Tables with Pulled Data
toc: true
badges: true
comments: true
categories: [general]
nb_path: _notebooks/2020-11-30-Advanced Tables with Pulled Data.ipynb
layout: notebook
---

<!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2020-11-30-Advanced Tables with Pulled Data.ipynb
-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>NOTE:</strong> <em><strong>Major Work-in-Progress</strong></em>. Maybe not be coherent, and much of the work needs to be updated using tabulate rather than generating tables from scratch. This post was originally going to walk through the basics of building plain text tables from scratch using real data from the outset, but it got too complicated to quickly. A separate post ended up being written for that purpose.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Basic-Table-w/-Manual-Column-Size-Control">Basic Table w/ Manual Column Size Control<a class="anchor-link" href="#Basic-Table-w/-Manual-Column-Size-Control"> </a></h3><ul>
<li>The sample data is Covid-19 region 8 information pulled from the Illinois Department of Public Health.<ul>
<li>More data than is needed comes with this HTTP request.</li>
<li>Specific data used is for the County Test Positivity Reports.</li>
</ul>
</li>
<li>Code description:<ul>
<li><strong>line 8:</strong> printout of sample json object to show what the raw data looks like</li>
<li><strong>line 11:</strong> Simplest form of creating a header: string printing of strings</li>
<li><strong>line 14:</strong> The json object, 'countyTestPositivities', under 'CountryTestPositivityReports' contains a list of json objects inside - one for each county. The nested for loop takes the first object, loops through the nested list, then moves onto the next object and nested list.</li>
<li><strong>lines 16-26:</strong> rudementry data clean up for the plain text table<ul>
<li>This clean up involves both reformatting of data, but also ensuring that the cells in the table all line up.</li>
<li>Example - Data Formatting: "date" - <code>counties['reportDate'][:10]</code> takes the long datetime string and moves all of the time characters. It does this by cutting out any characters between the 10th character ([9]) in the string. There are better ways to do this using the datetime library, but this works as well.</li>
<li>Example - Table Formatting: "name"<ul>
<li>We want the name column to always be 1 characters wide.</li>
<li>The first step is the basic action of setting the name variable from the pulled data</li>
<li>The second step is the following, in reverse order of the code in line 19:<ul>
<li>(1) count (<code>len</code>) the number of characters in the name string</li>
<li>(2) subtract that number from the desired column width, which is 10 in this case (if the name is "Kane", then that would be 10 - 4 = 6)</li>
<li>(3) populate "name_fill" with a string of spaces the length of the result from the previous step (if the name is "Kane", then that would be a string of 6 spaces)</li>
</ul>
</li>
</ul>
</li>
<li>The column filler variable is setup for "name", "positive", "total", "daily_avg", and "seven_day_avg"</li>
</ul>
</li>
<li><strong>line 27:</strong> The content portion of the table is printed one line at a time using a combination of bars, spaces, and the pair of data variable and filler variable</li>
<li><strong>line 28:</strong> Closes the bottm of the table with another string to match the header</li>
</ul>
</li>
<li>See the output further below for a visual of the raw data example, and the resulting plain text table</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">build_title</span><span class="p">(</span><span class="s1">&#39;COUNTY TEST POSITIVITY REPORTS&#39;</span><span class="p">))</span>

<span class="n">query_url</span> <span class="o">=</span> <span class="s1">&#39;https://idph.illinois.gov/DPHPublicInformation/api/COVID/GetResurgenceData?regionID=8&amp;daysIncluded=5&#39;</span> <span class="c1">#+ selectedRegion + &#39;&amp;daysIncluded=&#39; + chartRange</span>
<span class="n">page</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">query_url</span><span class="p">)</span>

<span class="n">positivity_rates</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;CountyTestPositivityReports&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;SINGLE SAMPLE&#39;</span><span class="p">)</span>
<span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">positivity_rates</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;+-----------------------------------------------------------+&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;| DATE       |  NAME      | POS    | TOTAL  | AVG   | 7 DAY |&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;|-----------------------------------------------------------|&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">counties</span> <span class="ow">in</span> <span class="n">positivity_rates</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">counties</span><span class="p">[</span><span class="s1">&#39;countyTestPositivities&#39;</span><span class="p">]:</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">counties</span><span class="p">[</span><span class="s1">&#39;reportDate&#39;</span><span class="p">][:</span><span class="mi">10</span><span class="p">]</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;CountyName&#39;</span><span class="p">]</span>
        <span class="n">name_fill</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">*</span><span class="p">(</span><span class="mi">10</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
        <span class="n">positive</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;positive_test&#39;</span><span class="p">]</span>
        <span class="n">positive_fill</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">*</span><span class="p">(</span><span class="mi">6</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">positive</span><span class="p">)))</span>
        <span class="n">total</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;totalTest&#39;</span><span class="p">]</span>
        <span class="n">total_fill</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">*</span><span class="p">(</span><span class="mi">6</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">total</span><span class="p">)))</span>
        <span class="n">daily_avg</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;positive_test&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;totalTest&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># positive tests / total tests * 100, then rounded to 1 decimal place</span>
        <span class="n">daily_avg_fill</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span><span class="p">(</span><span class="mi">5</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">daily_avg</span><span class="p">)))</span>
        <span class="n">seven_day_avg</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;positivityRollingAvg&#39;</span><span class="p">]</span>
        <span class="n">seven_fill</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">*</span><span class="p">(</span><span class="mi">5</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">seven_day_avg</span><span class="p">)))</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;| </span><span class="si">{</span><span class="n">date</span><span class="si">}</span><span class="s1"> | </span><span class="si">{</span><span class="n">name</span><span class="si">}{</span><span class="n">name_fill</span><span class="si">}</span><span class="s1"> | </span><span class="si">{</span><span class="n">positive</span><span class="si">}{</span><span class="n">positive_fill</span><span class="si">}</span><span class="s1"> | </span><span class="si">{</span><span class="n">total</span><span class="si">}{</span><span class="n">total_fill</span><span class="si">}</span><span class="s1"> | </span><span class="si">{</span><span class="n">daily_avg</span><span class="si">}{</span><span class="n">daily_avg_fill</span><span class="si">}</span><span class="s1"> | </span><span class="si">{</span><span class="n">seven_day_avg</span><span class="si">}{</span><span class="n">seven_fill</span><span class="si">}</span><span class="s1"> |&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;+-----------------------------------------------------------+&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Basic-Table-with-Cleaned-Up-Data-(and-also-w/-Manual-Column-Size-Control)">Basic Table with Cleaned Up Data (and also w/ Manual Column Size Control)<a class="anchor-link" href="#Basic-Table-with-Cleaned-Up-Data-(and-also-w/-Manual-Column-Size-Control)"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">date</span>

<span class="c1"># TABLE PARAMETERS</span>
<span class="n">line_length</span> <span class="o">=</span> <span class="mi">59</span>

<span class="nb">print</span><span class="p">(</span><span class="n">build_title</span><span class="p">(</span><span class="s1">&#39;COUNTY TEST POSITIVITY REPORTS&#39;</span><span class="p">))</span>

<span class="n">query_url</span> <span class="o">=</span> <span class="s1">&#39;https://idph.illinois.gov/DPHPublicInformation/api/COVID/GetResurgenceData?regionID=8&amp;daysIncluded=10&#39;</span> <span class="c1">#+ selectedRegion + &#39;&amp;daysIncluded=&#39; + chartRange</span>
<span class="n">page</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">query_url</span><span class="p">)</span>

<span class="n">positivity_rates</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;CountyTestPositivityReports&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;SINGLE SAMPLE&#39;</span><span class="p">)</span>
<span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">positivity_rates</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">behind</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">positivity_rates</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;reportDate&#39;</span><span class="p">],</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%S&quot;</span><span class="p">)</span>
<span class="n">behind_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;CURRENT DATE: </span><span class="si">{</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="si">}</span><span class="s1"> (Report is </span><span class="si">{</span><span class="p">(</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span> <span class="o">-</span> <span class="n">behind</span><span class="o">.</span><span class="n">date</span><span class="p">())</span><span class="o">.</span><span class="n">days</span><span class="si">}</span><span class="s1"> days *behind*)&#39;</span>
<span class="n">behind_fill</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">*</span><span class="p">(</span><span class="mi">57</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">behind_str</span><span class="p">))</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;+</span><span class="si">{</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="n">line_length</span><span class="si">}</span><span class="s1">+&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;| </span><span class="si">{</span><span class="n">behind_str</span><span class="si">}{</span><span class="n">behind_fill</span><span class="si">}</span><span class="s1"> |&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;|</span><span class="si">{</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="n">line_length</span><span class="si">}</span><span class="s1">|&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;| NAME       | DATE       | POS    | TOTAL  | AVG   | 7 DAY |&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;|</span><span class="si">{</span><span class="s2">&quot;-&quot;</span><span class="o">*</span><span class="n">line_length</span><span class="si">}</span><span class="s1">|&#39;</span><span class="p">)</span>
<span class="n">number_of_counties</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">positivity_rates</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;countyTestPositivities&#39;</span><span class="p">])</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_counties</span><span class="p">):</span>
    <span class="n">print_name</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">for</span> <span class="n">counties</span> <span class="ow">in</span> <span class="n">positivity_rates</span><span class="p">:</span>
        <span class="n">county</span> <span class="o">=</span> <span class="n">counties</span><span class="p">[</span><span class="s1">&#39;countyTestPositivities&#39;</span><span class="p">][</span><span class="n">n</span><span class="p">]</span><span class="c1">#[n-1]</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">counties</span><span class="p">[</span><span class="s1">&#39;reportDate&#39;</span><span class="p">][:</span><span class="mi">10</span><span class="p">]</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">county</span><span class="p">[</span><span class="s1">&#39;CountyName&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">print_name</span> <span class="o">==</span> <span class="kc">True</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
        <span class="n">name_fill</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">*</span><span class="p">(</span><span class="mi">10</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
        <span class="n">positive</span> <span class="o">=</span> <span class="n">county</span><span class="p">[</span><span class="s1">&#39;positive_test&#39;</span><span class="p">]</span>
        <span class="n">positive_fill</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">*</span><span class="p">(</span><span class="mi">6</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">positive</span><span class="p">)))</span>
        <span class="n">total</span> <span class="o">=</span> <span class="n">county</span><span class="p">[</span><span class="s1">&#39;totalTest&#39;</span><span class="p">]</span>
        <span class="n">total_fill</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">*</span><span class="p">(</span><span class="mi">6</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">total</span><span class="p">)))</span>
        <span class="n">daily_avg</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">county</span><span class="p">[</span><span class="s1">&#39;positive_test&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">county</span><span class="p">[</span><span class="s1">&#39;totalTest&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># positive tests / total tests * 100, then rounded to 1 decimal place</span>
        <span class="n">daily_avg_fill</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span><span class="p">(</span><span class="mi">5</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">daily_avg</span><span class="p">)))</span>
        <span class="n">seven_day_avg</span> <span class="o">=</span> <span class="n">county</span><span class="p">[</span><span class="s1">&#39;positivityRollingAvg&#39;</span><span class="p">]</span>
        <span class="n">seven_fill</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">*</span><span class="p">(</span><span class="mi">5</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">seven_day_avg</span><span class="p">)))</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;| </span><span class="si">{</span><span class="n">name</span><span class="si">}{</span><span class="n">name_fill</span><span class="si">}</span><span class="s1"> | </span><span class="si">{</span><span class="n">date</span><span class="si">}</span><span class="s1"> | </span><span class="si">{</span><span class="n">positive</span><span class="si">}{</span><span class="n">positive_fill</span><span class="si">}</span><span class="s1"> | </span><span class="si">{</span><span class="n">total</span><span class="si">}{</span><span class="n">total_fill</span><span class="si">}</span><span class="s1"> | </span><span class="si">{</span><span class="n">daily_avg</span><span class="si">}{</span><span class="n">daily_avg_fill</span><span class="si">}</span><span class="s1"> | </span><span class="si">{</span><span class="n">seven_day_avg</span><span class="si">}{</span><span class="n">seven_fill</span><span class="si">}</span><span class="s1"> |&#39;</span><span class="p">)</span>
        <span class="n">print_name</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;+</span><span class="si">{</span><span class="s2">&quot;-&quot;</span><span class="o">*</span><span class="n">line_length</span><span class="si">}</span><span class="s1">+&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Tables-Created-with-tabulate">Tables Created with <strong>tabulate</strong><a class="anchor-link" href="#Tables-Created-with-tabulate"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Regular-tabulate-table">Regular tabulate table<a class="anchor-link" href="#Regular-tabulate-table"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Pandas-tabulate-table">Pandas tabulate table<a class="anchor-link" href="#Pandas-tabulate-table"> </a></h2><ul>
<li>tablefmt options: <code>plain</code>, <code>simple</code>, <code>github</code>, <code>grid</code>, <code>fancy_grid</code>, <code>pipe</code>, <code>orgtbl</code>, <code>jira</code>, <code>fpresto</code>, <code>pretty</code>, <code>psql</code>, <code>rst</code>, <code>mediawiki</code>, <code>moinmoin</code>, <code>youtrack</code>, <code>html</code>, <code>latex</code>, <code>latex_raw</code>, <code>latex_booktabs</code>, <code>textile</code></li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">tabulate</span> <span class="kn">import</span> <span class="n">tabulate</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">datetime</span>

<span class="n">query_url</span> <span class="o">=</span> <span class="s1">&#39;https://idph.illinois.gov/DPHPublicInformation/api/COVID/GetResurgenceData?regionID=8&amp;daysIncluded=10&#39;</span> <span class="c1"># max is 170 days #+ selectedRegion + &#39;&amp;daysIncluded=&#39; + chartRange</span>
<span class="n">page</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">query_url</span><span class="p">)</span>

<span class="n">positivity_rates</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;CountyTestPositivityReports&#39;</span><span class="p">]</span>

<span class="n">flattened_positivity_rates</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">dates</span> <span class="ow">in</span> <span class="n">positivity_rates</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">county</span> <span class="ow">in</span> <span class="n">dates</span><span class="p">[</span><span class="s1">&#39;countyTestPositivities&#39;</span><span class="p">]:</span>
        <span class="n">county</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">dates</span><span class="p">[</span><span class="s1">&#39;reportDate&#39;</span><span class="p">],</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%S&quot;</span><span class="p">)</span>
        <span class="n">flattened_positivity_rates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">county</span><span class="p">)</span>

<span class="n">county_test_pos_rates_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">flattened_positivity_rates</span><span class="p">)</span>
<span class="n">county_test_pos_rates_df</span><span class="p">[</span><span class="s1">&#39;daily_avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">county_test_pos_rates_df</span><span class="p">[</span><span class="s1">&#39;positive_test&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">county_test_pos_rates_df</span><span class="p">[</span><span class="s1">&#39;totalTest&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span>

<span class="nb">print</span><span class="p">(</span><span class="n">tabulate</span><span class="p">(</span><span class="n">county_test_pos_rates_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s1">&#39;CountyName&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">]),</span> <span class="n">headers</span> <span class="o">=</span> <span class="s1">&#39;keys&#39;</span><span class="p">,</span> <span class="n">tablefmt</span> <span class="o">=</span> <span class="s1">&#39;psql&#39;</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Aside:-Same-Pandas-Data-Visualized">Aside: Same Pandas Data Visualized<a class="anchor-link" href="#Aside:-Same-Pandas-Data-Visualized"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="n">query_url</span> <span class="o">=</span> <span class="s1">&#39;https://idph.illinois.gov/DPHPublicInformation/api/COVID/GetResurgenceData?regionID=8&amp;daysIncluded=90&#39;</span> <span class="c1"># max is 170 days #+ selectedRegion + &#39;&amp;daysIncluded=&#39; + chartRange</span>
<span class="n">page</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">query_url</span><span class="p">)</span>

<span class="n">positivity_rates</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;CountyTestPositivityReports&#39;</span><span class="p">]</span>

<span class="n">flattened_positivity_rates</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">dates</span> <span class="ow">in</span> <span class="n">positivity_rates</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">county</span> <span class="ow">in</span> <span class="n">dates</span><span class="p">[</span><span class="s1">&#39;countyTestPositivities&#39;</span><span class="p">]:</span>
        <span class="n">county</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">dates</span><span class="p">[</span><span class="s1">&#39;reportDate&#39;</span><span class="p">],</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%S&quot;</span><span class="p">)</span>
        <span class="n">flattened_positivity_rates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">county</span><span class="p">)</span>

<span class="n">county_test_pos_rates_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">flattened_positivity_rates</span><span class="p">)</span>
<span class="n">county_test_pos_rates_df</span><span class="p">[</span><span class="s1">&#39;daily_avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">county_test_pos_rates_df</span><span class="p">[</span><span class="s1">&#39;positive_test&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">county_test_pos_rates_df</span><span class="p">[</span><span class="s1">&#39;totalTest&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span>

<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.dpi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">150</span>
<span class="n">county_test_pos_rates_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;daily_avg&#39;</span><span class="p">,</span> <span class="s1">&#39;positivityRollingAvg&#39;</span><span class="p">],</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;date&#39;</span><span class="p">);</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p><div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#collapse-hide</span>

<span class="c1"># SAME GRAPH, BUT WITH INTERACTIVE ADJUSTMENTS</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">from</span> <span class="nn">ipywidgets</span> <span class="kn">import</span> <span class="n">interact</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="n">query_url</span> <span class="o">=</span> <span class="s1">&#39;https://idph.illinois.gov/DPHPublicInformation/api/COVID/GetResurgenceData?regionID=8&amp;daysIncluded=90&#39;</span> <span class="c1"># max is 170 days #+ selectedRegion + &#39;&amp;daysIncluded=&#39; + chartRange</span>
<span class="n">page</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">query_url</span><span class="p">)</span>

<span class="n">positivity_rates</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;CountyTestPositivityReports&#39;</span><span class="p">]</span>

<span class="n">flattened_positivity_rates</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">dates</span> <span class="ow">in</span> <span class="n">positivity_rates</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">county</span> <span class="ow">in</span> <span class="n">dates</span><span class="p">[</span><span class="s1">&#39;countyTestPositivities&#39;</span><span class="p">]:</span>
        <span class="n">county</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">dates</span><span class="p">[</span><span class="s1">&#39;reportDate&#39;</span><span class="p">],</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%S&quot;</span><span class="p">)</span>
        <span class="n">flattened_positivity_rates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">county</span><span class="p">)</span>

<span class="n">county_test_pos_rates_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">flattened_positivity_rates</span><span class="p">)</span>
<span class="n">county_test_pos_rates_df</span><span class="p">[</span><span class="s1">&#39;daily_avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">county_test_pos_rates_df</span><span class="p">[</span><span class="s1">&#39;positive_test&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">county_test_pos_rates_df</span><span class="p">[</span><span class="s1">&#39;totalTest&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">100</span>

<span class="nd">@interact</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">500</span><span class="p">),</span> <span class="n">days</span><span class="o">=</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">93</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">graph</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">days</span><span class="o">=</span><span class="mi">93</span><span class="p">):</span>
    <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.dpi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dpi</span>
    <span class="n">number_prev_days</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">()</span> <span class="o">-</span> <span class="n">timedelta</span> <span class="p">(</span><span class="n">days</span><span class="p">)</span>
    <span class="n">filtered_df</span><span class="o">=</span><span class="n">county_test_pos_rates_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;date &lt;= &#39;</span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="si">}</span><span class="s2">&#39; and date &gt;= &#39;</span><span class="si">{</span><span class="n">number_prev_days</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
    <span class="n">filtered_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;daily_avg&#39;</span><span class="p">,</span> <span class="s1">&#39;positivityRollingAvg&#39;</span><span class="p">],</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;date&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>
</p>
    </details>
</div>
    {% endraw %}

</div>
 

